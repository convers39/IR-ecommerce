{% extends 'account/account-base.html' %}
{% block extra_head %}
<!-- EXTRA HEAD -->
{% endblock extra_head %}
<!-- TAGS -->
{% load mptt_tags %}


<!-- HERO SECTION-->
{% block hero %}
<li class="breadcrumb-item active" aria-current="page">
  Account
</li>
{% endblock hero %}


<!-- SHOP SIDEBAR-->

<!-- USER INFO-->
{% block detail %}
<div class="col-lg-9 order-1 order-lg-2 mb-5 mb-lg-0">
  <!-- <div class="row mb-3 align-items-center">
    <div class="col-lg-6 mb-2 mb-lg-0">
      <p class="text-small text-muted mb-0">
        Showing 1â€“12 of 53 results
      </p>
    </div>
    <div class="col-lg-6">
      <ul class="list-inline d-flex align-items-center justify-content-lg-end mb-0">
        <li class="list-inline-item text-muted mr-3">
          <a class="reset-anchor p-0" href="#"><i class="fas fa-th-large"></i></a>
        </li>
        <li class="list-inline-item text-muted mr-3">
          <a class="reset-anchor p-0" href="#"><i class="fas fa-th"></i></a>
        </li>
        <li class="list-inline-item">
          <select class="selectpicker ml-auto" name="sorting" data-width="200"
            data-style="bs-select-form-control" data-title="Default sorting">
            <option value="default">Default sorting</option>
            <option value="popularity">Popularity</option>
            <option value="low-high">Price: Low to High</option>
            <option value="high-low">Price: High to Low</option>
          </select>
        </li>
      </ul>
    </div>
  </div> -->
  <div class="row">
    <!-- PRODUCT-->
    <div class="container">
      <form action="#" id="userInfo">
        {% csrf_token %}
        <div class="row">
          <div class="col-lg-6 form-group">
            <label class="text-small text-uppercase" for="username">Username</label>
            {{form.username}}
          </div>
          <div class="col-lg-6 form-group">
            <label class="text-small text-uppercase" for="email">Email address</label>
            {{form.email}}
          </div>
          <div class="col-lg-6 form-group">
            <label class="text-small text-uppercase" for="first_name">First name</label>
            {{form.first_name}}
          </div>
          <div class="col-lg-6 form-group">
            <label class="text-small text-uppercase" for="last_name">Last name</label>
            {{form.last_name }}
          </div>
          <div class="col-lg-6 form-group">
            <label class="text-small text-uppercase" for="phone_no">Phone number</label>
            {{form.phone_no }}
          </div>
        </div>
        <div class="col-lg-12 form-group text-right" id="changeButton">
          <button class="btn btn-dark" type="submit" id="change">Change Profile</button>
        </div>

        <div class="col-lg-12 form-group text-right" id="saveButton" style="display:none">
          <button class="btn btn-dark" type="submit" id="save">Save</button>
          <button class="btn btn-dark" type="reset" id="cancel">Cancel</button>
        </div>
        <div class="col-lg-12 form-group">
          <!-- <label class="text-small text-uppercase" for="date_joined"></label> -->
          <div class="text-right text-small">
            Date Joined: {{user.date_joined|date:"DATE_FORMAT"}}
            <i class="fa fa-check-square px-2" aria-hidden="true"></i>
            Email Activated
          </div>
        </div>
      </form>
      <div>
      </div>
    </div>
  </div>

</div>
{% endblock detail %}

<!-- BOTTOM -->
{% block bottom %}
<script>
  $(function () {
    let inputAreas = $('#userInfo').find('input')
    inputAreas.each(function () {
      $(this).prop('readonly', true);
    })

    $('#change').click(function (event) {
      event.preventDefault();
      //$('#changeButton').prop('hidden', true);
      $('#changeButton').toggle();
      $('#saveButton').toggle();
      inputAreas.each(function () {
        $(this).removeAttr('readonly')
      })
    })

    $('#cancel').click(function (event) {
      event.preventDefault();
      $('#changeButton').toggle();
      $('#saveButton').toggle();
      inputAreas.each(function () {
        $(this).prop('readonly', true);
      })
    })

    $('#userInfo').submit(async function (event) {
      event.preventDefault();
      const csrftoken = Cookies.get('csrftoken');
      const formData = new FormData(event.currentTarget);
      const plainData = Object.fromEntries(formData.entries());

      const res = await fetch('/account/', {
        method: 'POST',
        headers: {
          "X-CSRFToken": csrftoken,
          "Content-Type": "application/json",
        },
        body: JSON.stringify(plainData),
      })
      const data = await res.json();
      if (data.res == '1') {
        console.log(data)
        $('#changeButton').toggle();
        $('#saveButton').toggle();
        inputAreas.each(function () {
          $(this).prop('readonly', true);
        })
        showMsg(data.msg, 1)
      } else {
        console.log(data);
        showMsg(data.errmsg, 0)
      }
    })
  })

</script>
{% endblock bottom%}
